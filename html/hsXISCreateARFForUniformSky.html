<html>
<body>
<pre>
#!/bin/bash

if [ _$1 = _ ]; then
echo &quot;give xis number (and rmax optional)&quot;
echo &quot;output will be arfs/xisN_uniform_0_20arcmin.arf&quot;
exit -1
fi

n=$1
rmax=20
if [ _$2 != _ ]; then
rmax=$2
fi
num=10000000


arffile=arfs/xis${n}_uniform_0_${rmax}arcmin.arf
evtfile=../data/xis${n}_evt.evt
attfile=`ls ../auxil/ae*.att 2&gt; /dev/null`
rmf=responses/xis${n}.rmf
logfile=logs/xis${n}_uniform_0_${rmax}arcmin.log
obsid=`<span style="text-decoration:line-through;color:blue;">obs_id.sh</span><span style="color:red;">hsFitsGetObsID</span> $evtfile`

if [ ! -f $evtfile -o ! -f $attfile ]; then
echo &quot;event file or att file is missing...&quot;
exit
fi

#create log file
if [ ! -f $logfile ]; then
 touch $logfile
 if [ ! -f $logfile ]; then
  echo &quot;Creating log file failed...&quot;
  exit
 fi
fi


#extract pi file
tmpdir=`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`_xselect
if [ -d $tmpdir -o -f $tmpdir ]; then
tmpdir=`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`_xselect
fi
mkdir $tmpdir
tmppi=`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`.pi
pushd $tmpdir &amp;&gt; /dev/null
xselect &lt;&lt; EOF &gt;&gt; ../$logfile

read e ../$evtfile ./
bin spec
save spec $tmppi
no
exit
no
EOF
popd &amp;&gt; /dev/null
tmppi=$tmpdir/$tmppi

#calculate arf
rm -rf $arffile

ea1=`<span style="text-decoration:line-through;color:blue;">mean_ea1.sh</span><span style="color:red;">hsFitsGetMeanEA1</span> $evtfile`
ea2=`<span style="text-decoration:line-through;color:blue;">mean_ea2.sh</span><span style="color:red;">hsFitsGetMeanEA2</span> $evtfile`
ea3=`<span style="text-decoration:line-through;color:blue;">mean_ea3.sh</span><span style="color:red;">hsFitsGetMeanEA3</span> $evtfile`
regionfile=regions/xis${n}_uniform_0_${rmax}arcmin.reg
aemkreg -xis $ea1 $ea2 $ea3 &gt; $regionfile

#check if area discre is needed for XIS0
if [ $n = 0 ]; then
 yyyy_mm_dd=`<span style="text-decoration:line-through;color:blue;">date_obs_only_yyyymmdd.sh</span><span style="color:red;">hsFitsGetDateObsYYYYMMDD</span> $evtfile`
 yyyy=`echo &quot;$yyyy_mm_dd&quot; | awk -F&quot;-&quot; &#39;{print $1}&#39;`
 mm=`echo &quot;$yyyy_mm_dd&quot; | awk -F&quot;-&quot; &#39;{print $2}&#39;`
 dd=`echo &quot;$yyyy_mm_dd&quot; | awk -F&quot;-&quot; &#39;{print $3}&#39;`
 yyyymmdd=`calc &quot;$yyyy+$mm/12+$dd/365&quot;`
 yesno=`perl -e &quot;if($yyyymmdd&gt;2009.65){print &#39;yes&#39;;}else{print &#39;no&#39;}&quot;`
 if [ $yesno = yes ]; then
  echo &quot;Adding Area Discre to region file (creating temporary region file)...&quot;
  tmp_region=`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`_region
  cp $regionfile $tmp_region
  tmp_xis_fov=`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`_xis_fov
  <span style="text-decoration:line-through;color:blue;">xis_fov.sh</span><span style="color:red;">hsXISFOV</span> $evtfile &gt; $tmp_xis_fov
  cat $tmp_xis_fov | grep \\-box &gt;&gt; $tmp_region
  regionfile=$tmp_region
  delete_regionfile=yes
  rm -f $tmp_xis_fov
  echo &quot;Adding Area Discre to region file (creating temporary region file)...done&quot;
 fi
fi

echo &quot;Starting xissimarfgen for $obsid&quot;

nice xissimarfgen instrume=XIS${n} pointing=AUTO source_mode=UNIFORM \
  source_rmin=0 source_rmax=$rmax num_region=1 \
  region_mode=SKYREG regfile1=${regionfile} arffile1=${arffile} \
  limit_mode=NUM_PHOTON num_photon=${num} phafile=${tmppi} detmask=none \
  gtifile=${evtfile} \
  attitude=${attfile} \
  rmffile=${rmf} estepfile=medium \
  event_freq=10000000 &gt;&gt; $logfile

rm -rf $tmppi $tmpdir
if [ _$delete_regionfile = _yes ]; then
rm -f $regionfile
fi
</pre>
</body>
</html>
