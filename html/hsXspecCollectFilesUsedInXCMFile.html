<html>
<body>
<pre>
#!/usr/bin/env ruby

#20100312 Takayuki Yuasa

require &quot;fileutils&quot;

if(ARGV.length&lt;2)then
print &quot;<span style="text-decoration:line-through;color:blue;">xspec_collect_data_from_xcm_file.rb</span><span style="color:red;">hsXspecCollectFilesUsedInXCMFile</span> (xcm file) (output folder name)\n&quot;
exit
end

input_xcmfile=ARGV[0]
output_foldername=ARGV[1]
SavedXCMFolder=&quot;xcm&quot;
SavedDataFolder=&quot;data&quot;
SavedXCMFile=&quot;load.xcm&quot;

keywords=[&quot;data&quot;,&quot;response&quot;,&quot;arf&quot;,&quot;backgrnd&quot;,&quot;corfile&quot;]

files_from=[]
files_to=[]
currentdir=[&quot;./&quot;]

if(!File.exist?(output_foldername))then
 Dir::mkdir(output_foldername)
end

if(!File.exist?(&quot;#{output_foldername}/#{SavedDataFolder}&quot;))then
 Dir::mkdir(&quot;#{output_foldername}/#{SavedDataFolder}&quot;)
end

if(!File.exist?(&quot;#{output_foldername}/#{SavedXCMFolder}&quot;))then
 Dir::mkdir(&quot;#{output_foldername}/#{SavedXCMFolder}&quot;)
end

print &quot;creating an xcm file for loading data...\n&quot;
outputfile=File.open(&quot;#{output_foldername}/#{SavedXCMFolder}/#{SavedXCMFile}&quot;,&#39;w&#39;)

open(input_xcmfile).each { |line|
	printed=false
	if(line.index(&quot;cd &quot;)==0)then
		currentdir.push(line.split(&quot; &quot;)[-1]+&quot;/&quot;)
		printed=true
	end
	keywords.each {|keyword|
		if(line.index(keyword)==0)then
			linearray=line.split(&quot; &quot;)
			file=currentdir[-1]+linearray[2]
			files_from.push(file)
			basename=File.basename(file)
			files_to.push(&quot;#{output_foldername}/#{SavedDataFolder}/#{basename}&quot;)
			outputfile.puts(&quot;#{linearray[0]} #{linearray[1]} #{SavedDataFolder}/#{basename}&quot;)
			printed=true
		end
	}
	if(printed==false)then
		outputfile.puts(line)
	end
}


print &quot;copying data...\n&quot;
for i in 0...files_from.length do
print &quot; copying #{files_to[i]}...\n&quot;
FileUtils.cp(files_from[i],files_to[i])
end

print &quot;done\n&quot;

outputfile.close()
</pre>
</body>
</html>
