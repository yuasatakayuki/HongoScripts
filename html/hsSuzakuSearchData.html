<html>
<body>
<pre>
#!/usr/bin/env ruby

#2013-09-18 Takayuki Yuasa

require &#39;net/http&#39;
require &quot;cgi&quot;
require &quot;csv&quot;

#############################################
# Functions
#############################################
def escape(str)
	return CGI.escape(str)
end

# Target Name
def getSearchURLForName(name)
	return &quot;http://darts.isas.jaxa.jp/astro/suzaku/suzakumaster/suzakuMasterSearchCondition.do?lookupDispatchKey=SEARCH&amp;max=100&amp;sort=OBSID&amp;sortSeq=%2B&amp;line=short&amp;searchMenu=CSV&amp;areaQueryChecked=on&amp;areaShape=fov&amp;areaQueryType=targetName&amp;target=#{escape(name.join(&quot; &quot;))}&quot;
end

# Coordinate J2000
def getSearchURLForCoordinateJ2000(coordinate)
	return &quot;http://darts.isas.jaxa.jp/astro/suzaku/suzakumaster/suzakuMasterSearchCondition.do?lookupDispatchKey=SEARCH&amp;max=100&amp;sort=OBSID&amp;sortSeq=%2B&amp;line=short&amp;searchMenu=CSV&amp;areaQueryChecked=on&amp;areaShape=fov&amp;areaQueryType=coordinate&amp;coo=#{escape(coordinate.join(&quot; &quot;))}&amp;coo_type=J2000&quot;
end

# Coordinate Galactic
def getSearchURLForCoordinateGalactic(coordinate)
	return &quot;http://darts.isas.jaxa.jp/astro/suzaku/suzakumaster/suzakuMasterSearchCondition.do?lookupDispatchKey=SEARCH&amp;max=100&amp;sort=OBSID&amp;sortSeq=%2B&amp;line=short&amp;searchMenu=CSV&amp;areaQueryChecked=on&amp;areaShape=fov&amp;areaQueryType=coordinate&amp;coo=#{escape(coordinate.join(&quot; &quot;))}&amp;coo_type=Galactic&quot;
end

# Period - observation date
def getSearchURLForObservationDate(array)
	startYear=array[0]
	startMonth=array[1]
	startDay=array[2]
	endYear=array[3]
	endMonth=array[4]
	endDay=array[5]
	return &quot;http://darts.isas.jaxa.jp/astro/suzaku/suzakumaster/suzakuMasterSearchCondition.do?lookupDispatchKey=SEARCH&amp;max=100&amp;sort=OBSID&amp;sortSeq=%2B&amp;line=short&amp;searchMenu=CSV&amp;dateChecked=on&amp;obs_date_startY=#{startYear}&amp;obs_date_startM=#{startMonth}&amp;obs_date_startD=#{startDay}&amp;obs_date_endY=#{endYear}&amp;obs_date_endM=#{endMonth}&amp;obs_date_endD=#{endDay}&amp;proc_date_startY=null&amp;proc_date_startM=null&amp;proc_date_endY=null&amp;proc_date_endM=null&amp;pub_date_startY=null&amp;pub_date_startM=null&amp;pub_date_endY=null&amp;pub_date_endM=null&amp;dis_date_startY=null&amp;dis_date_startM=null&amp;dis_date_endY=null&amp;dis_date_endM=null&quot;
end

# Period - public date
def getSearchURLForPublicDate(array)
	startYear=array[0]
	startMonth=array[1]
	startDay=array[2]
	endYear=array[3]
	endMonth=array[4]
	endDay=array[5]
	return &quot;http://darts.isas.jaxa.jp/astro/suzaku/suzakumaster/suzakuMasterSearchCondition.do?lookupDispatchKey=SEARCH&amp;max=100&amp;sort=OBSID&amp;sortSeq=%2B&amp;line=short&amp;searchMenu=CSV&amp;dateChecked=on&amp;obs_date_startY=null&amp;obs_date_startM=null&amp;obs_date_startD=null&amp;obs_date_endY=null&amp;obs_date_endM=null&amp;obs_date_endD=null&amp;proc_date_startY=null&amp;proc_date_startM=null&amp;proc_date_endY=null&amp;proc_date_endM=null&amp;pub_date_startY=#{startYear}&amp;pub_date_startM=#{startMonth}&amp;pub_date_startD=#{startDay}&amp;pub_date_endY=#{endYear}&amp;pub_date_endM=#{endMonth}&amp;pub_date_endD=#{endDay}&amp;dis_date_startY=null&amp;dis_date_startM=null&amp;dis_date_endY=null&amp;dis_date_endM=null&quot;
end

# Pattern match - abstract
def getSearchURLForAbstract(keywords)
	return &quot;http://darts.isas.jaxa.jp/astro/suzaku/suzakumaster/suzakuMasterSearchCondition.do?lookupDispatchKey=SEARCH&amp;max=100&amp;sort=OBSID&amp;sortSeq=%2B&amp;line=short&amp;searchMenu=CSV&amp;patternChecked=on&amp;name=&amp;obsid=&amp;adstract=#{escape(keywords.join(&quot; &quot;))}&amp;pi=&amp;co_pi=&amp;title=&amp;proc_ver=&amp;prnb=&quot;
end

# Pattern match - PI name
def getSearchURLForPI(piName)
	return &quot;http://darts.isas.jaxa.jp/astro/suzaku/suzakumaster/suzakuMasterSearchCondition.do?lookupDispatchKey=SEARCH&amp;max=100&amp;sort=OBSID&amp;sortSeq=%2B&amp;line=short&amp;searchMenu=CSV&amp;patternChecked=on&amp;name=&amp;obsid=&amp;adstract=&amp;pi=#{escape(piName.join(&quot; &quot;))}&amp;co_pi=&amp;title=&amp;proc_ver=&amp;prnb=&quot;
end

# get url depending on search mode
def getURL(mode, keywords)
	if(mode==&quot;name&quot;)then
		return getSearchURLForName(keywords)
	end
	if(mode==&quot;radec&quot; or mode==&quot;j2000&quot; or mode==&quot;J2000&quot;)then
		return getSearchURLForCoordinateJ2000(keywords)
	end
	if(mode==&quot;gal&quot; or mode==&quot;galactic&quot; or mode==&quot;Galactic&quot;)then
		return getSearchURLForCoordinateGalactic(keywords)
	end
	if(mode==&quot;date&quot; or mode==&quot;obsDate&quot; or mode==&quot;obsdate&quot; or mode==&quot;dateobs&quot;)then
		return getSearchURLForObservationDate(keywords)
	end
	if(mode==&quot;publicDate&quot; or mode==&quot;public&quot;)then
		return getSearchURLForPublicDate(keywords)
	end
	if(mode==&quot;abstract&quot;)then
		return getSearchURLForAbstract(keywords)
	end
	if(mode==&quot;pi&quot; or mode==&quot;piName&quot;)then
		return getSearchURLForPI(keywords)
	end
end

#############################################
# Main process
#############################################

if(ARGV.length&lt;2)then
puts &lt;&lt;EOS
usage: <span style="text-decoration:line-through;color:blue;">suzakuSearchData</span><span style="color:red;">hsSuzakuSearchData</span> (mode) (search keywods)
	mode = name/j2000/radec/gal/galactic/date/publicDate/abstract/piName/pi
	search keywords = array of keywords
	e.g.
		(1) <span style="text-decoration:line-through;color:blue;">suzakuSearchData</span><span style="color:red;">hsSuzakuSearchData</span> date 2009 03 28 2010 04 01
		(2) <span style="text-decoration:line-through;color:blue;">suzakuSearchData</span><span style="color:red;">hsSuzakuSearchData</span> name v1223 sgr
		(3) <span style="text-decoration:line-through;color:blue;">suzakuSearchData</span><span style="color:red;">hsSuzakuSearchData</span> pi yuasa
EOS
exit
end

mode=ARGV[0]
ARGV.shift()




#Get result
uri = URI(getURL(mode,ARGV))
response = Net::HTTP.get(uri)



#remove escaped double quotations
response.gsub!(/&quot;&quot;/,&#39;&#39;)
reader=CSV.parse(response)

#Display result
r=reader[0]

puts &quot;=============================================================================================&quot;
puts &quot;#{&quot;%-20s&quot;%r[0]} #{&quot;%-7s&quot;%r[1]}  #{&quot;%-7s&quot;%r[2]}  #{&quot;%-19s&quot;%r[6]}  #{&quot;%-9s&quot;%r[8]}  #{&quot;%-12s&quot;%r[9]}  #{r[38]}&quot;
puts &quot;=============================================================================================&quot;

reader.shift()
reader.each(){ |r| 
time=r[6]
if(time!=nil and time!=&quot;null&quot;)then
	puts &quot;#{&quot;%-20s&quot;%r[0]} #{&quot;%7.3f&quot;%r[1].to_f}  #{&quot;%7.3f&quot;%r[2].to_f}  #{&quot;%-19s&quot;%r[6]}  #{&quot;%-9s&quot;%r[8]}  #{&quot;%-12.2f&quot;%r[9]}  #{r[38]}&quot;
end
}
</pre>
</body>
</html>
