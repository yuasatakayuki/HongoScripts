<html>
<body>
<pre>
#!/bin/bash

function dumpMessage() {
cat &lt;&lt; EOF 1&gt;&amp;2

Note:
Run this script in xis/image_analysis/ folder so that
the program can find needed files automatically (e.g. att file).

EOF
}

#check arguments
if [ _$2 = _ ]; then
name=`basename $0`
cat &lt;&lt; EOF 1&gt;&amp;2
usage : $name (xis PI fits file) (output event list fits file name)
EOF
dumpMessage
exit -1
fi

#check folder path
path=`<span style="text-decoration:line-through;color:blue;">get_folder_path.sh</span><span style="color:red;">hsFolderGetPath</span> 2`
if [ _$path != _ -a $path = &quot;xis/image_analysis&quot; ]; then
echo &quot;&quot;
else
dumpMessage
exit -1
fi

#set parameters
eventfile=$1
outputfile=$2

xisn=`<span style="text-decoration:line-through;color:blue;">instrume.sh</span><span style="color:red;">hsFitsGetInstume</span> $eventfile`
ra=`<span style="text-decoration:line-through;color:blue;">getheader.sh</span><span style="color:red;">hsFitsGetHeader</span> $eventfile 0 RA_NOM`
dec=`<span style="text-decoration:line-through;color:blue;">getheader.sh</span><span style="color:red;">hsFitsGetHeader</span> $eventfile 0 DEC_NOM`
exposure=10000
ea1=`<span style="text-decoration:line-through;color:blue;">getheader.sh</span><span style="color:red;">hsFitsGetHeader</span> $eventfile 0 MEAN_EA1`
ea2=`<span style="text-decoration:line-through;color:blue;">getheader.sh</span><span style="color:red;">hsFitsGetHeader</span> $eventfile 0 MEAN_EA2`
ea3=`<span style="text-decoration:line-through;color:blue;">getheader.sh</span><span style="color:red;">hsFitsGetHeader</span> $eventfile 0 MEAN_EA3`

#check RMF existence
n=`<span style="text-decoration:line-through;color:blue;">xis_get_xis_number.sh</span><span style="color:red;">hsXISGetXISNumber</span> $eventfile`
rmffile=../spectral_analysis/responses/xis${n}.rmf
if [ ! -f $rmffile ]; then
pushd ../spectral_analysis &amp;&gt; /dev/null
echo &quot;preparing RMF file...&quot; 1&gt;&amp;2
<span style="text-decoration:line-through;color:blue;">xis_create_response_matrix.sh</span><span style="color:red;">hsXISCreateResponseMatrix</span> &amp;&gt; ../spectral_analysis/logs/xis_create_response_matrix.log
popd &amp;&gt; /dev/null
#check RMF again
if [ ! -f $rmffile ]; then
echo &quot;RMF generation failed...&quot; 1&gt;&amp;2
exit -1
else
echo &quot;RMF generation done...&quot;
fi
fi


#check ATT file
attfile=`ls ../auxil/ae*.att 2&gt; /dev/null | tail -1`
if [ _$attfile = _ ]; then
echo &quot;att file is not found&quot; 1&gt;&amp;2
exit -1
fi

#execute
rm -f $outputfile
xissim instrume=$xisn enable_photongen=yes photon_flux=10 flux_emin=1.0 \
flux_emax=10.0 spec_mode=1 image_mode=2 time_mode=0 limit_mode=1 energy=2.45 \
ra=$ra dec=$dec sky_r_min=0 sky_r_max=20 exposure=$exposure \
pointing=AUTO gtifile=&quot;${eventfile}[2]&quot; attitude=$attfile \
ea1=$ea1 ea2=$ea2 ea3=$ea3 \
xis_rmffile=$rmffile \
event_freq=10000000 \
outfile=$outputfile phafile=$eventfile

if [ _$outputfile != _ -a -f $outputfile ]; then
echo &quot;Event list &#39;$outputfile&#39; is successfully created.&quot; 1&gt;&amp;2
else
echo &quot;Execution failed...&quot; 1&gt;&amp;2
exit -1
fi
</pre>
</body>
</html>
