<html>
<body>
<pre>
#!/bin/bash

#20090902 Takayuki Yuasa

if [ _$1 = _ ];
then

cat &lt;&lt; EOF
<span style="text-decoration:line-through;color:blue;">fits_calculate_folded_lightcurve.sh</span><span style="color:red;">hsFitsCalculateFoldedLightcurve</span> \\
                          (1:input event file) \\
                          (2:output fits file prefix) \\
                          (3:output plot file prefix) \\
                          (4:folding period in sec) \\
                          (5:number of bins per phase) \\
                          (6:numer of bins per interval) \\
                          (7:number of intervals per frame;optional)
EOF
exit

fi

#parameters
windowfile=$hongoscriptsdir/astrophysics/etc/<span style="text-decoration:line-through;color:blue;">xronos_nowindow.wi</span><span style="color:red;">hsFtoolsXronosNoWindow.wi</span>

inputfile=$1
outputprefix=$2
plotprefix=$3
period=$4
numberofbinsperphase=$5
numberofbinsperinterval=$6

if [ _$7 = _ ];
then
numberofintervalsperframe=1000000
else
numberofintervalsperframe=$7
fi

#output plot files
psfile=${plotprefix}.ps

#create directory
mkdir -p `dirname $outputprefix` &amp;&gt; /dev/null
mkdir -p `dirname $plotprefix` &amp;&gt; /dev/null

#delete qdp files
<span style="text-decoration:line-through;color:blue;">delete_qdp_files.sh</span><span style="color:red;">hsQDPDeleteQDPFiles</span> ${outputprefix}.qdp
<span style="text-decoration:line-through;color:blue;">delete_qdp_files.sh</span><span style="color:red;">hsQDPDeleteQDPFiles</span> ${plotprefix}.qdp

#tmporary files
tmpqdpprefix=`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`

#calculate folded lightcurve
efold \
 nser=1 \
 cfile1=&quot;$inputfile&quot; \
 window=$windowfile \
 sepoch=INDEF \
 dper=$period \
 nphase=$numberofbinsperphase \
 nbint=$numberofbinsperinterval \
 nintfm=$numberofintervalsperframe \
 plot=yes \
 plotdev=&quot;/xw&quot; \
 outfile=&quot;${outputprefix}.fef&quot; &lt;&lt; EOF

we $tmpqdpprefix
exit

EOF

#get max/min of the plot
ymax=`<span style="text-decoration:line-through;color:blue;">qdp_get_plot_range_from_a_pco_file.sh</span><span style="color:red;">hsQDPGetPlotRangeFromPCO</span> ${tmpqdpprefix}.pco y2 maximum`
ymax=`calc &quot;$ymax*1.3&quot;`

#plot with appropriate range
qdp $tmpqdpprefix &lt;&lt; EOF
/xw
la f 
ti of
lwidth 3
lwidth 3 on 1..50
fo ro
cs 1.3
r y 0 $ymax
we ${plotprefix}
hard $psfile/cps
exit
EOF

rm -f ${tmpqdpprefix}.pco ${tmpqdpprefix}.qdp

#convert ps to pdf
pushd `dirname $plotprefix`

ps2pdf `basename $psfile`

popd
</pre>
</body>
</html>
