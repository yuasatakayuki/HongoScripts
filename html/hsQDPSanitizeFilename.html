<html>
<body>
<pre>
#!/bin/bash

#20090902 Takayuki Yuasa
#20090903 Takayuki Yuasa

if [ _$1 = _ ];
then
echo &quot;<span style="text-decoration:line-through;color:blue;">qdp_sanitize_filename.sh</span><span style="color:red;">hsQDPSanitizeFilename</span> (file name string to be sanitized)&quot;
exit
fi

filename=$1


ruby &lt;&lt; EOF
str=&quot;$filename&quot;
array=str.split(&quot;.&quot;)

size=array.length

if(size==1)then
 print str
 exit
end

if(size==2 &amp;&amp; (array[size-1]!=&quot;pco&quot; &amp;&amp; array[size-1]!=&quot;qpd&quot;))then
 print &quot;#{array[0]}_#{array[1]}&quot;
 exit
end

#if(size==2)then
# print &quot;#{array[0]}_#{array[1]}&quot;
#end

for i in 0...(array.length-2)
 print &quot;#{array[i]}_&quot;
end
if(array[size-1]!=&quot;pco&quot; &amp;&amp; array[size-1]!=&quot;qpd&quot;)then
 #not qdp suffix. so all dots should be removed
 print &quot;#{array[array.length-2]}_#{array[array.length-1]}&quot;
else
 #qdp&#39;s suffix. so the last block should be connected with a dot
 print &quot;#{array[array.length-2]}.#{array[array.length-1]}&quot;
end

EOF
</pre>
</body>
</html>
