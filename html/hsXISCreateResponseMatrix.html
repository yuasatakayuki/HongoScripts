<html>
<body>
<pre>
#!/bin/bash

#20090315 Takayuki Yuasa

echo &quot;create Response Matrix File for XIS0-3 and FI/BI using xisrmfgen&quot;

outputdir=responses

pwd=`pwd`
indexof=`<span style="text-decoration:line-through;color:blue;">indexof.pl</span><span style="color:red;">hsStringIndex</span> &quot;$pwd&quot; &quot;xis/spectral_analysis&quot;`
if [ $indexof == -1 ];
then
echo &quot;run this script at analysis/xis/spectral_analysis/ folder.&quot;
exit
fi

if [ ! -d $outputdir ];
then
echo &quot;error: output folder &#39;responses/&#39; not found&quot;
exit
fi

logfile=$outputdir/<span style="text-decoration:line-through;color:blue;">xis_create_response_matrix.sh</span><span style="color:red;">hsXISCreateResponseMatrix</span>.log

tmp=`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`.pha


##################################
#xis0-3 and BI
##################################
for xis in xis0 xis1 xis2 xis3 bi;
do
evtfile=../data/${xis}_evt.evt

if [ -f $evtfile ];
then
xselect &lt;&lt; EOF 2&gt;&amp;1 | tee -a $logfile

no
read event $evtfile ./
extract spec
save spec $tmp
no

exit

EOF

xisrmfgen phafile=$tmp outfile=responses/${xis}.rmf clobber=yes
rm -f $tmp

fi
done


##################################
#FI
##################################
cd $outputdir
tmp=`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`
ls xis0.rmf xis2.rmf xis3.rmf 1&gt; $tmp 2&gt; /dev/null
num=`<span style="text-decoration:line-through;color:blue;">file_linenumber.sh</span><span style="color:red;">hsFileCountLineNumber</span> $tmp`
#FI file check
if [ _$num = _ ];
then
echo &quot;Error in FI response creation&quot;
exit
fi

#condition
if [ _$num = _3 ];
then
echo &quot;3 FI chips&quot;
weights=&quot;0.333,0.333,0.333&quot;
fi

if [ _$num = _2 ];
then
echo &quot;2 FI chips&quot;
weights=&quot;0.5,0.5&quot;
fi

if [ _$num = _1 ];
then
echo &quot;1 FI chip&quot;
weights=&quot;1.0&quot;
fi

#file list
filelist=&quot;&quot;
for file in `ls xis0.rmf xis2.rmf xis3.rmf 2&gt; /dev/null`;
do
filelist=${filelist},$file
done
filelist=`echo $filelist | sed -e &quot;s/^,//g&quot;`

echo &quot;File List = $filelist&quot;

addrmf &quot;$filelist&quot; &quot;$weights&quot; rmffile=fi.rmf clobber=yes 2&gt;&amp;1 | tee -a `basename $logfile`

rm -f $tmp
cd - &amp;&gt; /dev/null


</pre>
</body>
</html>
