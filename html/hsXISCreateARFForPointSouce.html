<html>
<body>
<pre>
#!/bin/bash

#20090315 Takayuki Yuasa
#20090608 Takayuki Yuasa
#20090710 Takayuki Yuasa for more informative log
#20100213 Takayuki Yuasa pixel quality selection is added (pixq_max)
#20100215 Takayuki Yuasa temporary folder name changed
#20100721 Takayuki Yuasa pixel quality selection changed (0:1023 =&gt; 0:524287)

if [ _$2 = _ ];
then
echo &quot;<span style="text-decoration:line-through;color:blue;">xis_create_auxiliary_response_file_for_pointsource.sh</span><span style="color:red;">hsXISCreateARFForPointSouce</span> (region file) (xis number;0-3) (source RA;optional) (source DEC;optional)&quot;
echo &quot; note : output arf file name is something link arfs/xisN_(region filename).arf&quot;
exit
fi

pwd=`pwd`
indexof=`<span style="text-decoration:line-through;color:blue;">indexof.pl</span><span style="color:red;">hsStringIndex</span> &quot;$pwd&quot; &quot;xis/spectral_analysis&quot;`
if [ $indexof == -1 ];
then
echo &quot;run this script at analysis/xis/spectral_analysis/ folder.&quot;
exit
fi

####################
#parameter set
####################
regionfile=$1
n=$2

evtfile=../data/xis${n}_evt.evt

mkdir -p arfs/ &amp;&gt; /dev/null
arffile=arfs/xis${n}_`basename $regionfile .reg`.arf
rm -f $arffile


attfile=`ls ../auxil/ae*.att 2&gt; /dev/null`
rmf=responses/xis${n}.rmf

#if ra,dec are given
#if not, RA_OBJ,DEC_OBJ in header will be used
if [ _$4 != _ ];
then
ra_obj=$3
dec_obj=$4
else
if [ -f $evtfile ];
then
ra_obj=`<span style="text-decoration:line-through;color:blue;">ra_obj.sh</span><span style="color:red;">hsFitsGetRAOBJ</span> $evtfile`
dec_obj=`<span style="text-decoration:line-through;color:blue;">dec_obj.sh</span><span style="color:red;">hsGetFitsDecObj</span> $evtfile`
fi
fi

####################
#log start
####################
logfile=${arffile}.log
cat &lt;&lt; EOF 2&gt;&amp;1 | tee -a $logfile
######################################
######### new run of arfgen###########
Starts from `<span style="text-decoration:line-through;color:blue;"><span style="text-decoration:line-through;color:blue;">dateyymmdd</span><span style="color:red;">hsDateYYYYMMDD</span>_hhmm</span><span style="color:red;">hsDateYYYYMMDD_HHMM</span>`
PWD = `pwd`
XISn = $n
Source Ra,Dec=(${ra_obj},${dec_obj})
######################################
EOF


####################
#check
####################
if [ ! -f $regionfile ];
then
echo &quot;region file ($regionfile) was not found&quot; 2&gt;&amp;1 | tee -a $logfile
exit
fi

if [ ! -f $evtfile ];
then
echo &quot;event file ($evtfile) was not found&quot; 2&gt;&amp;1 | tee -a $logfile
exit
fi

if [ ! -d ../auxil ];
then
echo &quot;../auxil was not found&quot; 2&gt;&amp;1 | tee -a $logfile
exit
fi

if [ _$attfile = _ ];
then
echo &quot;att file was not found&quot; 2&gt;&amp;1 | tee -a $logfile
exit
fi

if [ ! -f $rmf ];
then
echo &quot;rmf ($rmf) was not found&quot; 2&gt;&amp;1 | tee -a $logfile
exit
fi

####################
#execute
####################
#create pha
#execute xselect to avoid possible collision
#in multi core cpu environment.
tmp=`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`.pha
tmpdir=tmp/`<span style="text-decoration:line-through;color:blue;">get_hash_random.pl</span><span style="color:red;">hsHashRandom</span>`
echo &quot;temporary directory is ${tmpdir}&quot;
mkdir -p $tmpdir
pushd $tmpdir
xselect &lt;&lt; EOF 2&gt;&amp;1 | tee -a ../../$logfile

no
read event ../../$evtfile ./
extract spec
save spec ../../$tmp
no

exit

EOF
popd
rm -rf $tmpdir


#xis sim arf gen
nice xissimarfgen instrume=XIS${n} pointing=AUTO source_mode=J2000 \
  source_ra=${ra_obj} source_dec=${dec_obj} num_region=1 \
  region_mode=SKYREG regfile1=${regionfile} arffile1=${arffile} \
  limit_mode=MIXED num_photon=500000 phafile=${tmp} detmask=none \
  accuracy=0.005 \
  gtifile=${evtfile} \
  attitude=${attfile} \
  rmffile=${rmf} estepfile=medium \
  event_freq=1000000 \
  enable_pixq=yes pixq_max=524287 2&gt;&amp;1 | tee -a $logfile

rm -f $tmp

<span style="text-decoration:line-through;color:blue;"><span style="text-decoration:line-through;color:blue;">dateyymmdd</span><span style="color:red;">hsDateYYYYMMDD</span>_hhmm</span><span style="color:red;">hsDateYYYYMMDD_HHMM</span> 2&gt;&amp;1 | tee -a $logfile
echo &quot;######### end run ###########&quot; 2&gt;&amp;1 | tee -a $logfile
</pre>
</body>
</html>
