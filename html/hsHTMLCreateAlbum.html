<html>
<body>
<pre>
#!/usr/bin/env ruby

#20130509 Takayuki Yuasa
#20130709 Takayuki Yuasa fancybox

#============================================
#
#============================================
cssFileName=&quot;style.css&quot;
indexFileName=&quot;index.html&quot;
pageTitle=&quot;Sample Page&quot;
nPerLine=4
bodyWidth=1100
tableWidth=1000
thumbnailSize=250
thumbnailDir=&quot;thumbnails&quot;
largeImageDir=&quot;largeImages&quot;

#============================================
# Create thumbnails
#============================================
puts &quot;Creating thumbnails...&quot;
if(!File.exist?(thumbnailDir))then
	`mkdir -p #{thumbnailDir}`
end
if(!File.exist?(largeImageDir))then
	`mkdir -p #{largeImageDir}`
end
for file in ARGV do
	if(!File.exist?(thumbnailDir+&quot;/&quot;+file))then
		puts &quot;Resizing #{file}...&quot;
		`convert -resize #{thumbnailSize}x${thumbnailSize} -auto-orient #{file} #{thumbnailDir}/#{File.basename(file)}`
	end
	if(!File.exist?(largeImageDir+&quot;/&quot;+file))then
		puts &quot;Resizing #{file}...&quot;
		`convert -auto-orient #{file} #{largeImageDir}/#{File.basename(file)}`
	end
end

#============================================
# Javascript
#============================================
if(!File.exist?(&quot;js&quot;))then
	`mkdir js`
	`cd js;curl -O http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js; cd ..`
	`cd js;curl -O http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js; cd ..`
	`cd js;curl -O https://codeload.github.com/fancyapps/fancyBox/legacy.zip/v2.1.5;unzip v2.1.5;mv fancyapps-fancyBox* fancybox;cd ..`
end

#============================================
# Create CSS File
#============================================
cssFile=open(cssFileName, &quot;w&quot;)

cssFile.write &lt;&lt;EOS
body {
	font-family:&#39;ヒラギノ角ゴ Pro W3&#39;,&#39;Hiragino Kaku Gothic Pro&#39;,&#39;メイリオ&#39;,Meiryo,&#39;ＭＳ Ｐゴシック&#39;,sans-serif;
	font-size: 11pt;
	width: #{bodyWidth}px;
	margin: auto;
	padding-top: 20px;
}

img { 
	border: 1px solid #ccc;
	background-color: #fafafa;
	padding: 5px;
	margin: 10px;
}

table {
	border: none;
	width: #{tableWidth} px;
	font-size: 11pt;
	font-weight: normal;
	text-align: center;
}

tr{
	height: #{thumbnailSize+20}px;
}

td{
	width: #{thumbnailSize+20}px;
}
EOS


#============================================
# Create Index File
#============================================
indexFile=open(&quot;#{indexFileName}&quot;,&quot;w&quot;)
indexFile.write &lt;&lt;EOS
&lt;html&gt;
&lt;head&gt;

&lt;script src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/jquery-ui.min.js&quot;&gt;&lt;/script&gt; 
&lt;script type=&quot;text/javascript&quot; src=&quot;js/fancybox/lib/jquery.mousewheel-3.0.6.pack.js&quot;&gt;&lt;/script&gt;

&lt;!-- Add fancyBox --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;js/fancybox/source/jquery.fancybox.css?v=2.1.5&quot; type=&quot;text/css&quot; media=&quot;screen&quot; /&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/fancybox/source/jquery.fancybox.pack.js?v=2.1.5&quot;&gt;&lt;/script&gt;


&lt;script type=&quot;text/javascript&quot;&gt;
	$(document).ready(function() {
		$(&quot;.fancybox&quot;).fancybox({
			prevEffect		: &#39;none&#39;,
			nextEffect		: &#39;none&#39;,
			openEffect		: &#39;elastic&#39;,
			closeEffect		: &#39;elastic&#39;,
			loop					: &#39;false&#39;,
			
			closeBtn		: false
		});
	});
&lt;/script&gt;


&lt;title&gt;
#{pageTitle}
&lt;/title&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;#{cssFileName}&quot;&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;
#{pageTitle}
&lt;/h2&gt;
&lt;table&gt;
EOS

i=0
fileIndex=0
for file in ARGV do
	if(i==0)then
		indexFile.write &quot;&lt;tr&gt;\n&quot;
	end
	if(i&lt;nPerLine)then
		date=`jhead #{file}  | grep Date | awk &#39;{print $3,$4}&#39;`
		indexFile.write &quot;&lt;td&gt;&lt;a href=\&quot;#{largeImageDir}/#{file}\&quot; rel=\&quot;group\&quot; class=\&quot;fancybox\&quot; title=\&quot;#{date}\&quot;&gt;&lt;img src=\&quot;thumbnails/#{file}\&quot;&gt;&lt;/a&gt;&lt;br/&gt;#{date}&lt;/td&gt; &lt;!-- fileIndex=#{fileIndex} --&gt;\n&quot;
		if(fileIndex==ARGV.length-1)then
			indexFile.write &quot;&lt;/tr&gt;\n&quot;
		end
		i=i+1
		fileIndex=fileIndex+1
	end
	if(i==nPerLine)then
		indexFile.write &quot;&lt;/tr&gt;\n&quot;
		i=0
	end
end

indexFile.write &lt;&lt;EOS
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
EOS
</pre>
</body>
</html>
